<mat-dialog-content>
  <section>
    <mat-icon class="suunto" svgIcon="suunto"></mat-icon>
    <p class="no-margin">Import your history</p>
  </section>
  <form *ngIf="formGroup" [formGroup]="formGroup">
    <app-shade [isActive]="isLoading"></app-shade>

    <mat-horizontal-stepper formArrayName="formArray" [linear]="true" #stepper>

      <mat-step formGroupName="0" [stepControl]="formArray?.get([0])">
        <ng-template matStepLabel>Setup the dates</ng-template>

        <!-- Start Date -->
        <mat-form-field>
          <input matInput [matDatepicker]="startDate" placeholder="Start Date" formControlName="startDate">
          <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
          <mat-datepicker #startDate></mat-datepicker>
          <mat-hint>The start date</mat-hint>
          <mat-error *ngIf="hasError(0, 'startDate')">
            invalid date
          </mat-error>
        </mat-form-field>

        <!-- End Date -->
        <mat-form-field>
          <input matInput [matDatepicker]="endDate" placeholder="End Date" formControlName="endDate">
          <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
          <mat-datepicker #endDate></mat-datepicker>
          <mat-hint>The end date</mat-hint>
          <mat-error *ngIf="hasError(0, 'startDate')">
            invalid date
          </mat-error>
        </mat-form-field>

        <button mat-stroked-button (click)="close($event)" type="button">Cancel</button>
        <button mat-stroked-button color="primary" matStepperNext>Next</button>
      </mat-step>

      <mat-step formGroupName="1" [stepControl]="formArray?.get([1])">
        <ng-template matStepLabel>Confirm</ng-template>
        <p><b>Start date</b>: {{ formGroup.get('formArray')['controls'][0].get('startDate').value | date: 'medium' }}</p>
        <p><b>End date</b>: {{ formGroup.get('formArray')['controls'][0].get('endDate').value | date: 'medium' }}</p>

        <p *ngIf="userMetaForService && userMetaForService.didLastHistoryImport">Your last history import was at {{ userMetaForService.didLastHistoryImport | date: 'medium'}}</p>
        <mat-checkbox formControlName="accepted" [disabled]="!isAllowedToDoHistoryImport">
          <mat-hint><b>Confirm</b>: History import can take up to days depending on how many activities you have. <b>Only after a week you will be able to redo an import</b></mat-hint>
        </mat-checkbox>

        <mat-error *ngIf="!isAllowedToDoHistoryImport">You have imported your history less than one week ago!</mat-error>
        <button mat-stroked-button matStepperPrevious>Back</button>
        <button mat-flat-button color="primary" (click)="onSubmit()" [disabled]="!this.formGroup.valid">Import</button>
      </mat-step>

    </mat-horizontal-stepper>
  </form>


</mat-dialog-content>
