<mat-card>
  <mat-card-header>
    <mat-card-title>
      <section class="title">
        <app-activity-icon [activity]="event.getFirstActivity()"
                           *ngIf="event.getActivities().length === 1 "></app-activity-icon>
        <mat-icon *ngIf="event.getActivities().length > 1 " style="margin-right: 0.2vw;">
          compare_arrows
        </mat-icon>
        <span>{{ event.name.slice(0, 70) }}</span>
      </section>
    </mat-card-title>
    <app-event-card-actions-menu [event]="event" align="end"></app-event-card-actions-menu>
    <mat-card-subtitle>
      <mat-icon>access_time</mat-icon>
      <span class="mat-body-2">{{ event.getFirstActivity().startDate | date:'medium' }}</span>
    </mat-card-subtitle>
    <mat-card-subtitle>
      <mat-icon>filter_{{ event.getActivities().length }}</mat-icon>
      Activities of total
      <span class="mat-body-2">{{ (event.getDistance().getValue()/1000).toFixed(2) }}</span> km
      in
      <span class="mat-body-2">{{ event.getDuration().getDisplayValue() }}</span>
    </mat-card-subtitle>
    <mat-card-subtitle>
      <span *ngIf="event.getFirstActivity().geoLocationInfo">
        <mat-icon>place</mat-icon>
        <span class="mat-body-2" *ngIf="event.getFirstActivity().geoLocationInfo.city">{{ event.getFirstActivity().geoLocationInfo.city }}, </span>
        <span *ngIf="event.getFirstActivity().geoLocationInfo.province">{{ event.getFirstActivity().geoLocationInfo.province }}, </span>
        <span *ngIf="event.getFirstActivity().geoLocationInfo.country">{{ event.getFirstActivity().geoLocationInfo.country }}</span>
      </span>
    </mat-card-subtitle>
    <mat-card-subtitle *ngIf="event.getFirstActivity().weather
    && event.getFirstActivity().weather.weatherItems.length
    && event.getFirstActivity().weather.getAverageTemperatureInCelsius() ">
      <mat-icon>terrain</mat-icon>
      <span class="mat-body-2">{{ event.getFirstActivity().weather.getAverageTemperatureInCelsius().toFixed(0) }}c</span>
      and
      <span class="mat-body-2">{{event.getFirstActivity().weather.weatherItems[0].conditions }}</span>
      conditions
    </mat-card-subtitle>
    <mat-card-subtitle *ngFor="let activity of event.getActivities(); let i = index;">
      <span *ngIf=" activity.creator.name">
          <mat-icon [ngStyle]="{'color':  eventColorService.getActivityColor(event, activity)}">watch</mat-icon>
          <span class="mat-body-2"><mat-chip-list><mat-chip>{{ activity.creator.name }}</mat-chip></mat-chip-list></span>
          <span class="mat-body-2"
                *ngIf=" activity.creator.swInfo">v{{ activity.creator.swInfo }}</span>
          <span *ngIf=" activity.creator.serialNumber"> - sn {{ activity.creator.serialNumber }}</span>
        </span>
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <mat-tab-group [dynamicHeight]="true" [selectedIndex]="selectedTabIndex"
                   (selectedIndexChange)="selectedTabIndexChange($event)">
      <mat-tab label="Map" *ngIf="event.hasPointsWithPosition()">
        <ng-template matTabLabel>
          <mat-icon>map</mat-icon>
        </ng-template>
        <app-event-card-map
          [event]="event">
        </app-event-card-map>
      </mat-tab>
      <mat-tab label="Stats">
        <ng-template matTabLabel>
          <mat-icon>insert_chart</mat-icon>
        </ng-template>
        <app-event-card-stats *ngIf="selectedTabIndex === (event.hasPointsWithPosition()? 1 : 0)"
                              [event]="event">
        </app-event-card-stats>
      </mat-tab>
      <mat-tab label="Chart">
        <ng-template matTabLabel>
          <mat-icon>show_chart</mat-icon>
        </ng-template>
        <app-event-card-chart *ngIf="selectedTabIndex === (event.hasPointsWithPosition()? 2 : 1)"
                              [event]="event">
        </app-event-card-chart>
      </mat-tab>
      <mat-tab label="Laps">
        <ng-template matTabLabel>
          <mat-icon>linear_scale</mat-icon>
        </ng-template>
        <app-event-card-laps [event]="event">
        </app-event-card-laps>
      </mat-tab>
      <mat-tab label="Tools"
               *ngIf="hasIBIData(event)">
        <ng-template matTabLabel>
          <mat-icon>build</mat-icon>
        </ng-template>
        <app-event-card-tools [event]="event"
                              *ngIf="selectedTabIndex === (event.hasPointsWithPosition()? 4 : 2)"></app-event-card-tools>
      </mat-tab>
    </mat-tab-group>
  </mat-card-content>
</mat-card>
