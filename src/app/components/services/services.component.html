<mat-card class="mat-elevation-z0" style="padding: 0;">
  <mat-grid-list [cols]="1" [rowHeight]="'fit'">
    <mat-grid-tile>
      <app-shade [isActive]="isLoading"></app-shade>
      <mat-card class="mat-elevation-z0 service-card">
        <mat-card-header>
          <!--          <div mat-card-avatar>-->
          <!--            <mat-icon class="suunto"  svgIcon="suunto"></mat-icon>-->
          <!--          </div>-->
          <mat-card-title>
            <mat-icon class="suunto" svgIcon="suunto"></mat-icon>
          </mat-card-title>
          <mat-card-subtitle>
            Suunto is a trusted companion for athletes and adventurers.<br/>
            The durable and precise sports watches are tested in the toughest conditions and built to last in adventures
            from the deepest oceans to the highest mountains.
            <!--            <mat-divider [inset]="true"></mat-divider>-->
          </mat-card-subtitle>
        </mat-card-header>
        <mat-tab-group [selectedIndex]="(!user || isGuest) ? 0 : 1"
                       [dynamicHeight]="true">
          <mat-tab label="Download">
            <!--            <app-shade [isActive]="isSaving" [hasError]="errorSaving" [errorMessage]="errorSaving"></app-shade>-->
            <ng-template matTabLabel>
              <mat-icon matTooltip="Download">cloud_download</mat-icon>
            </ng-template>
            <section>
              <form [formGroup]="suuntoAppLinkFormGroup" (submit)="onSubmit()" autocomplete="off">
                <mat-form-field>
                  <label>
                    <input matInput placeholder="Link" formControlName="input">
                  </label>
                  <mat-hint>Paste a Suunto app link that is public</mat-hint>
                  <mat-error *ngIf="hasError('input')">
                    This cannot be empty
                  </mat-error>
                </mat-form-field>
                <section>
                  <button class="big" mat-flat-button color="primary" (click)="onSubmit()">
                    Download
                  </button>
                  <button *ngIf="user" class="big"  mat-flat-button color="accent" (click)="onImportAndOpen()" >
                    Import and open
                  </button>
                </section>
              </form>
            </section>
          </mat-tab>

          <mat-tab label="Sync" [disabled]="!user || isGuest">
            <ng-template matTabLabel>
              <mat-icon matTooltip="Sync settings">sync</mat-icon>
            </ng-template>
            <section class="tab-content" *ngIf="user && !isGuest">

              <p *ngIf="!serviceTokens || !serviceTokens.length">
                Connect to Suunto app by Suunto and get almost realtime updates on your dashboard<br/>
                This needs to be revised
              </p>
              <!--            <p *ngIf="serviceTokens && serviceTokens.length">Up to 2 Suunto app accounts</p>-->
              <mat-list *ngIf="serviceTokens && serviceTokens.length">

                <div mat-subheader>Accounts</div>

                <mat-list-item style="text-align: left" *ngFor="let serviceToken of serviceTokens; let i = index;">
                  <mat-icon mat-list-icon>account_circle</mat-icon>
                  <div mat-line>{{ serviceToken.userName }} </div>
                  <div mat-line>Connected at {{serviceToken.dateCreated  | date:'medium'}}</div>
                </mat-list-item>
              </mat-list>

              <section>
                <button class="big"
                        mat-flat-button color="warn"
                        *ngIf="serviceTokens && serviceTokens.length"
                        (click)="deauthorizeSuuntoApp($event)">{{ serviceTokens && (serviceTokens.length > 1) ? 'Disconnect all' : 'Disconnect' }}
                </button>

                <button mat-stroked-button
                         class="big"
                  mat-flat-button color="primary" [disabled]="!user || this.isGuest"
                  *ngIf="(!user || this.isGuest) || (serviceTokens && serviceTokens.length < 2)"
                  (click)="connectWithSuuntoApp($event)">{{ serviceTokens && (serviceTokens.length === 1) ? 'Connect another' : 'Connect' }}
                </button>
              </section>
            </section>
          </mat-tab>

          <mat-tab label="History import" [disabled]="!user || isGuest || !serviceTokens || !serviceTokens.length">
            <!--            <app-shade [isActive]="isSaving" [hasError]="errorSaving" [errorMessage]="errorSaving"></app-shade>-->
            <ng-template matTabLabel>
              <mat-icon matTooltip="History import">history</mat-icon>
            </ng-template>

            <section class="tab-content" *ngIf="user && !isGuest">
              <app-history-import-form [user]="user"></app-history-import-form>
            </section>
          </mat-tab>
        </mat-tab-group>
      </mat-card>
    </mat-grid-tile>
  </mat-grid-list>
</mat-card>
